THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(e,t){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return e.copy(this),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){console.log("THREE.CanvasRenderer",THREE.REVISION),e=e||{};var F,A,I,D,G,U,q,X,J,Y,K,Q,me,fe,ve,ue,xe,Z=this,Re=new THREE.Projector,r=void 0!==e.canvas?e.canvas:document.createElement("canvas"),$=r.width,_=r.height,ee=Math.floor($/2),te=Math.floor(_/2),ye=0,Te=0,we=$,He=_,o=1,ie=r.getContext("2d",{alpha:!0===e.alpha}),i=new THREE.Color(0),n=!0===e.alpha?0:1,a=1,s=0,l=null,c=null,p=null,d=null,E=null,t=[],re=(new THREE.RenderableVertex,new THREE.RenderableVertex,new THREE.Color),ge=(new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color),Se=new THREE.Color,Me=new THREE.Color,oe={},ne=new THREE.Box2,ae=new THREE.Box2,se=new THREE.Box2,be=new THREE.Color,Ce=new THREE.Color,ze=new THREE.Color,Ve=new THREE.Vector3,je=new THREE.Vector3,le=new THREE.Vector3,ce=new THREE.Matrix3;function Le(e,t,i,r){ke(t),Ne(i),Fe(r),Ee(e.getStyle()),ie.stroke(),se.expandByScalar(2*t)}function Oe(e){he(e.getStyle()),ie.fill()}function Be(e){var t,i,r,o,n,a,s;return 0===e.version||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture?{canvas:void 0,version:e.version}:!1===(t=e.image).complete?{canvas:void 0,version:0}:(i=e.wrapS===THREE.RepeatWrapping||e.wrapS===THREE.MirroredRepeatWrapping,r=e.wrapT===THREE.RepeatWrapping||e.wrapT===THREE.MirroredRepeatWrapping,a=e.wrapS===THREE.MirroredRepeatWrapping,s=e.wrapT===THREE.MirroredRepeatWrapping,(o=document.createElement("canvas")).width=t.width*(a?2:1),o.height=t.height*(s?2:1),(n=o.getContext("2d")).setTransform(1,0,0,-1,0,t.height),n.drawImage(t,0,0),1==a&&(n.setTransform(-1,0,0,-1,t.width,t.height),n.drawImage(t,-t.width,0)),1==s&&(n.setTransform(1,0,0,1,0,0),n.drawImage(t,0,t.height)),1==a&&1==s&&(n.setTransform(-1,0,0,1,t.width,0),n.drawImage(t,-t.width,t.height)),a="no-repeat",1==i&&1==r?a="repeat":1==i?a="repeat-x":1==r&&(a="repeat-y"),s=ie.createPattern(o,a),e.onUpdate&&e.onUpdate(e),{canvas:s,version:e.version})}function We(e,t,i,r,o,n,a,s,l,c,p,d,E){var h=oe[E.id];if(void 0!==h&&h.version===E.version||(h=Be(E),oe[E.id]=h),void 0===h.canvas)return he("rgba( 0, 0, 0, 1)"),ie.fill();he(h.canvas);var h=E.offset.x/E.repeat.x,m=E.offset.y/E.repeat.y,f=E.image.width*E.repeat.x,E=E.image.height*E.repeat.y;l=(l+h)*f,c=(c+m)*E,p=(p+h)*f,d=(d+m)*E,i-=e,r-=t,o-=e,n-=t,0!=(h=(l-=a=(a+h)*f)*(d-=s=(s+m)*E)-(p-=a)*(c-=s))&&(e=e-(m=(d*i-c*o)*(f=1/h))*a-(E=(l*o-p*i)*f)*s,i=t-(h=(d*r-c*n)*f)*a-(o=(l*n-p*r)*f)*s,ie.save(),ie.transform(m,h,E,o,e,i),ie.fill(),ie.restore())}function Pe(e,t,i){var r=t.x-e.x,o=t.y-e.y,n=r*r+o*o;0!=n&&(r*=i=i/Math.sqrt(n),o*=i,t.x+=r,t.y+=o,e.x-=r,e.y-=o)}function pe(e){a!==e&&(ie.globalAlpha=e,a=e)}function de(e){s!==e&&(e===THREE.NormalBlending?ie.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?ie.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending?ie.globalCompositeOperation="darker":e===THREE.MultiplyBlending&&(ie.globalCompositeOperation="multiply"),s=e)}function ke(e){p!==e&&(ie.lineWidth=e,p=e)}function Ne(e){d!==e&&(ie.lineCap=e,d=e)}function Fe(e){E!==e&&(ie.lineJoin=e,E=e)}function Ee(e){l!==e&&(ie.strokeStyle=e,l=e)}function he(e){c!==e&&(ie.fillStyle=e,c=e)}function Ae(e){t.length!==e.length&&(ie.setLineDash(e),t=e)}void 0===ie.setLineDash&&(ie.setLineDash=function(){}),this.domElement=r,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return ie},this.getContextAttributes=function(){return ie.getContextAttributes()},this.getPixelRatio=function(){return o},this.setPixelRatio=function(e){void 0!==e&&(o=e)},this.setSize=function(e,t,i){$=e*o,_=t*o,r.width=$,r.height=_,ee=Math.floor($/2),te=Math.floor(_/2),!1!==i&&(r.style.width=e+"px",r.style.height=t+"px"),ne.min.set(-ee,-te),ne.max.set(ee,te),ae.min.set(-ee,-te),ae.max.set(ee,te),a=1,s=0,E=d=p=c=l=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,i,r){ye=e*o,Te=t*o,we=i*o,He=r*o},this.setScissor=function(){},this.setScissorTest=function(){},this.setClearColor=function(e,t){i.set(e),n=void 0!==t?t:1,ae.min.set(-ee,-te),ae.max.set(ee,te)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return i},this.getClearAlpha=function(){return n},this.getMaxAnisotropy=function(){return 0},this.clear=function(){!1===ae.isEmpty()&&(ae.intersect(ne),ae.expandByScalar(2),ae.min.x=ae.min.x+ee,ae.min.y=-ae.min.y+te,ae.max.x=ae.max.x+ee,ae.max.y=-ae.max.y+te,n<1&&ie.clearRect(0|ae.min.x,0|ae.max.y,ae.max.x-ae.min.x|0,ae.min.y-ae.max.y|0),0<n&&(de(THREE.NormalBlending),pe(1),he("rgba("+Math.floor(255*i.r)+","+Math.floor(255*i.g)+","+Math.floor(255*i.b)+","+n+")"),ie.fillRect(0|ae.min.x,0|ae.max.y,ae.max.x-ae.min.x|0,ae.min.y-ae.max.y|0)),ae.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,t){if(t instanceof THREE.Camera!=0){var i=e.background;i&&i.isColor?(he("rgb("+Math.floor(255*i.r)+","+Math.floor(255*i.g)+","+Math.floor(255*i.b)+")"),ie.fillRect(0,0,$,_)):!0===this.autoClear&&this.clear(),Z.info.render.vertices=0,Z.info.render.faces=0,ie.setTransform(we/$,0,0,-He/_,ye,_-Te),ie.translate(ee,te),F=Re.projectScene(e,t,this.sortObjects,this.sortElements),A=F.elements,I=F.lights,ce.getNormalMatrix(t.matrixWorldInverse),be.setRGB(0,0,0),Ce.setRGB(0,0,0),ze.setRGB(0,0,0);for(var r=0,P=I.length;r<P;r++){var o=I[r],n=o.color;o instanceof THREE.AmbientLight?be.add(n):o instanceof THREE.DirectionalLight?Ce.add(n):o instanceof THREE.PointLight&&ze.add(n)}for(var a=0,k=A.length;a<k;a++){var s,l,c,p,d,E,h=A[a],m=h.material;if(void 0!==m&&0!==m.opacity){if(se.makeEmpty(),h instanceof THREE.RenderableSprite)(D=h).x*=ee,D.y*=te,M=D,b=h,W=B=O=L=j=V=z=void 0,pe((C=m).opacity),de(C.blending),B=b.scale.x*ee,b=b.scale.y*te,W=.5*Math.sqrt(B*B+b*b),se.min.set(M.x-W,M.y-W),se.max.set(M.x+W,M.y+W),C instanceof THREE.SpriteMaterial?null!==(W=C.map)?(void 0!==(L=oe[W.id])&&L.version===W.version||(L=Be(W),oe[W.id]=L),void 0!==L.canvas&&(he(L.canvas),z=(L=W.image).width*W.offset.x,V=L.height*W.offset.y,O=B/(j=L.width*W.repeat.x),W=b/(L=L.height*W.repeat.y),ie.save(),ie.translate(M.x,M.y),0!==C.rotation&&ie.rotate(C.rotation),ie.translate(-B/2,-b/2),ie.scale(O,W),ie.translate(-z,-V),ie.fillRect(z,V,j,L),ie.restore())):(he(C.color.getStyle()),ie.save(),ie.translate(M.x,M.y),0!==C.rotation&&ie.rotate(C.rotation),ie.scale(B,-b),ie.fillRect(-.5,-.5,1,1),ie.restore()):C instanceof THREE.SpriteCanvasMaterial&&(Ee(C.color.getStyle()),he(C.color.getStyle()),ie.save(),ie.translate(M.x,M.y),0!==C.rotation&&ie.rotate(C.rotation),ie.scale(B,b),C.program(ie),ie.restore());else if(h instanceof THREE.RenderableLine){D=h.v1,G=h.v2,D.positionScreen.x*=ee,D.positionScreen.y*=te,G.positionScreen.x*=ee,G.positionScreen.y*=te,se.setFromPoints([D.positionScreen,G.positionScreen]);if(!0===ne.intersectsBox(se)){f=void 0;O=void 0;W=void 0;z=void 0;V=void 0;W=void 0;j=void 0;var f=D;O=G;W=h;z=m;if(pe(z.opacity),de(z.blending),ie.beginPath(),ie.moveTo(f.positionScreen.x,f.positionScreen.y),ie.lineTo(O.positionScreen.x,O.positionScreen.y),z instanceof THREE.LineBasicMaterial){if(ke(z.linewidth),Ne(z.linecap),Fe(z.linejoin),z.vertexColors!==THREE.VertexColors)Ee(z.color.getStyle());else{V=W.vertexColors[0].getStyle(),W=W.vertexColors[1].getStyle();if(V===W)Ee(V);else{try{j=ie.createLinearGradient(f.positionScreen.x,f.positionScreen.y,O.positionScreen.x,O.positionScreen.y);j.addColorStop(0,V),j.addColorStop(1,W)}catch(f){j=V}Ee(j)}}ie.stroke(),se.expandByScalar(2*z.linewidth)}else z instanceof THREE.LineDashedMaterial&&(ke(z.linewidth),Ne(z.linecap),Fe(z.linejoin),Ee(z.color.getStyle()),Ae([z.dashSize,z.gapSize]),ie.stroke(),se.expandByScalar(2*z.linewidth),Ae([]))}}else if(h instanceof THREE.RenderableFace){if(D=h.v1,G=h.v2,U=h.v3,D.positionScreen.z<-1||1<D.positionScreen.z)continue;if(G.positionScreen.z<-1||1<G.positionScreen.z)continue;if(U.positionScreen.z<-1||1<U.positionScreen.z)continue;if(D.positionScreen.x*=ee,D.positionScreen.y*=te,G.positionScreen.x*=ee,G.positionScreen.y*=te,U.positionScreen.x*=ee,U.positionScreen.y*=te,0<m.overdraw&&(Pe(D.positionScreen,G.positionScreen,m.overdraw),Pe(G.positionScreen,U.positionScreen,m.overdraw),Pe(U.positionScreen,D.positionScreen,m.overdraw)),se.setFromPoints([D.positionScreen,G.positionScreen,U.positionScreen]),!0===ne.intersectsBox(se)){L=void 0;M=void 0;B=void 0;b=void 0;C=void 0;v=void 0;u=void 0;x=void 0;E=void 0;d=void 0;p=void 0;c=void 0;l=void 0;s=void 0;R=void 0;y=void 0;T=void 0;w=void 0;N=void 0;S=void 0;g=void 0;H=void 0;L=D;M=G;B=U;b=0;C=1;var v=2;var u=h;var x=m;if(Z.info.render.vertices+=3,Z.info.render.faces++,pe(x.opacity),de(x.blending),U=L.positionScreen.x,q=L.positionScreen.y,X=M.positionScreen.x,J=M.positionScreen.y,Y=B.positionScreen.x,K=B.positionScreen.y,s=U,l=q,c=X,p=J,d=Y,E=K,ie.beginPath(),ie.moveTo(s,l),ie.lineTo(c,p),ie.lineTo(d,E),ie.closePath(),(x instanceof THREE.MeshLambertMaterial||x instanceof THREE.MeshPhongMaterial)&&null===x.map){ge.copy(x.color),Se.copy(x.emissive),x.vertexColors===THREE.FaceColors&&ge.multiply(u.color),re.copy(be),je.copy(L.positionWorld).add(M.positionWorld).add(B.positionWorld).divideScalar(3);for(var R=je,y=u.normalModel,T=re,w=0,N=I.length;w<N;w++){var H,g,S=I[w];Me.copy(S.color),S instanceof THREE.DirectionalLight?(g=Ve.setFromMatrixPosition(S.matrixWorld).normalize(),(H=y.dot(g))<=0||(H*=S.intensity,T.add(Me.multiplyScalar(H)))):S instanceof THREE.PointLight&&(g=Ve.setFromMatrixPosition(S.matrixWorld),(H=y.dot(Ve.subVectors(g,R).normalize()))<=0||0!=(H*=0==S.distance?1:1-Math.min(R.distanceTo(g)/S.distance,1))&&(H*=S.intensity,T.add(Me.multiplyScalar(H))))}re.multiply(ge).add(Se),!0===x.wireframe?Le(re,x.wireframeLinewidth,x.wireframeLinecap,x.wireframeLinejoin):Oe(re)}else x instanceof THREE.MeshBasicMaterial||x instanceof THREE.MeshLambertMaterial||x instanceof THREE.MeshPhongMaterial?null!==x.map?x.map.mapping===THREE.UVMapping&&(Q=u.uvs,We(U,q,X,J,Y,K,Q[b].x,Q[b].y,Q[C].x,Q[C].y,Q[v].x,Q[v].y,x.map)):null!==x.envMap?x.envMap.mapping===THREE.SphericalReflectionMapping&&(le.copy(u.vertexNormalsModel[b]).applyMatrix3(ce),Q=.5*le.x+.5,me=.5*le.y+.5,le.copy(u.vertexNormalsModel[C]).applyMatrix3(ce),fe=.5*le.x+.5,ve=.5*le.y+.5,le.copy(u.vertexNormalsModel[v]).applyMatrix3(ce),ue=.5*le.x+.5,xe=.5*le.y+.5,We(U,q,X,J,Y,K,Q,me,fe,ve,ue,xe,x.envMap)):(re.copy(x.color),x.vertexColors===THREE.FaceColors&&re.multiply(u.color),!0===x.wireframe?Le(re,x.wireframeLinewidth,x.wireframeLinecap,x.wireframeLinejoin):Oe(re)):(x instanceof THREE.MeshNormalMaterial?(le.copy(u.normalModel).applyMatrix3(ce),re.setRGB(le.x,le.y,le.z).multiplyScalar(.5).addScalar(.5)):re.setRGB(1,1,1),!0===x.wireframe?Le(re,x.wireframeLinewidth,x.wireframeLinecap,x.wireframeLinejoin):Oe(re))}}ae.union(se)}}ie.setTransform(1,0,0,1,0,0)}else console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");var M,b,C,z,V,j,L,O,B,W}},THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0},THREE.Projector=function(){var ne,ae,o,se,le,ce,pe,de,Ee,he,me,fe=[],ve=0,ue=[],t=0,i=[],r=0,n=[],a=0,xe=[],Re=0,ye={objects:[],lights:[],elements:[]},Te=new THREE.Vector3,we=new THREE.Vector4,f=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),v=new THREE.Box3,s=new Array(3),He=(new Array(4),new THREE.Matrix4),ge=new THREE.Matrix4,Se=new THREE.Matrix4,Me=new THREE.Matrix3,be=new THREE.Frustum,Ce=new THREE.Vector4,ze=new THREE.Vector4,Ve=(this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(e,t){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")},new function(){var l=[],c=[],p=null,d=null,E=new THREE.Matrix3;function r(e){var t=e.position,i=e.positionWorld,r=e.positionScreen,t=(i.copy(t).applyMatrix4(me),r.copy(i).applyMatrix4(ge),1/r.w);r.x*=t,r.y*=t,r.z*=t,e.visible=-1<=r.x&&r.x<=1&&-1<=r.y&&r.y<=1&&-1<=r.z&&r.z<=1}function h(e,t,i){return!0===e.visible||!0===t.visible||!0===i.visible||(s[0]=e.positionScreen,s[1]=t.positionScreen,s[2]=i.positionScreen,f.intersectsBox(v.setFromPoints(s)))}function m(e,t,i){return(i.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(i.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(e){d=(p=e).material,E.getNormalMatrix(p.matrixWorld),l.length=0,c.length=0},projectVertex:r,checkTriangleVisibility:h,checkBackfaceCulling:m,pushVertex:function(e,t,i){(o=je()).position.set(e,t,i),r(o)},pushNormal:function(e,t,i){l.push(e,t,i)},pushUv:function(e,t){c.push(e,t)},pushLine:function(e,t){e=ue[e],t=ue[t];(pe=Oe()).id=p.id,pe.v1.copy(e),pe.v2.copy(t),pe.z=(e.positionScreen.z+t.positionScreen.z)/2,pe.renderOrder=p.renderOrder,pe.material=p.material,ye.elements.push(pe)},pushTriangle:function(e,t,i){var r=ue[e],o=ue[t],n=ue[i];if(!1!==h(r,o,n)&&(d.side===THREE.DoubleSide||!0===m(r,o,n))){(le=Le()).id=p.id,le.v1.copy(r),le.v2.copy(o),le.v3.copy(n),le.z=(r.positionScreen.z+o.positionScreen.z+n.positionScreen.z)/3,le.renderOrder=p.renderOrder,le.normalModel.fromArray(l,3*e),le.normalModel.applyMatrix3(E).normalize();for(var a=0;a<3;a++){var s=le.vertexNormalsModel[a];s.fromArray(l,3*arguments[a]),s.applyMatrix3(E).normalize(),le.uvs[a].fromArray(c,2*arguments[a])}le.vertexNormalsLength=3,le.material=p.material,ye.elements.push(le)}}}});function je(){var e;return se!==t?ue[se++]:(e=new THREE.RenderableVertex,ue.push(e),t++,se++,e)}function Le(){var e;return ce!==r?i[ce++]:(e=new THREE.RenderableFace,i.push(e),r++,ce++,e)}function Oe(){var e;return de!==a?n[de++]:(e=new THREE.RenderableLine,n.push(e),a++,de++,e)}function Be(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}this.projectScene=function(e,t,P,k){function N(e){var t;(ne=ae!==ve?fe[ae++]:(t=new THREE.RenderableObject,fe.push(t),ve++,ae++,t)).id=e.id,ne.object=e,Te.setFromMatrixPosition(e.matrixWorld),Te.applyMatrix4(ge),ne.z=Te.z,ne.renderOrder=e.renderOrder,ye.objects.push(ne)}he=de=ce=0,!(ye.elements.length=0)===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),He.copy(t.matrixWorldInverse.getInverse(t.matrixWorld)),ge.multiplyMatrices(t.projectionMatrix,He),be.setFromMatrix(ge),ae=0,ye.objects.length=0,ye.lights.length=0,e.traverseVisible(function(e){e instanceof THREE.Light?ye.lights.push(e):e instanceof THREE.Mesh||e instanceof THREE.Line?!1===e.material.visible||!0===e.frustumCulled&&!1===be.intersectsObject(e)||N(e):e instanceof THREE.Sprite&&(!1===e.material.visible||!0===e.frustumCulled&&!1===be.intersectsSprite(e)||N(e))}),!0===P&&ye.objects.sort(Be);for(var i,r,o,n,a,s,l,c,p,F=0,A=ye.objects.length;F<A;F++){var d,E,h=ye.objects[F].object,m=h.geometry;if(Ve.setObject(h),me=h.matrixWorld,se=0,h instanceof THREE.Mesh){if(m instanceof THREE.BufferGeometry){var f=m.attributes,I=m.groups;if(void 0!==f.position){for(var v=0,u=(d=f.position.array).length;v<u;v+=3)Ve.pushVertex(d[v],d[v+1],d[v+2]);if(void 0!==f.normal)for(var x=f.normal.array,v=0,u=x.length;v<u;v+=3)Ve.pushNormal(x[v],x[v+1],x[v+2]);if(void 0!==f.uv){var D=f.uv.array;for(v=0,u=D.length;v<u;v+=2)Ve.pushUv(D[v],D[v+1])}if(null!==m.index){var R=m.index.array;if(0<I.length)for(var G=0;G<I.length;G++){var U=I[G];for(v=U.start,u=U.start+U.count;v<u;v+=3)Ve.pushTriangle(R[v],R[v+1],R[v+2])}else for(v=0,u=R.length;v<u;v+=3)Ve.pushTriangle(R[v],R[v+1],R[v+2])}else for(v=0,u=d.length/3;v<u;v+=3)Ve.pushTriangle(v,v+1,v+2)}}else if(m instanceof THREE.Geometry){var y=m.vertices,q=m.faces,X=m.faceVertexUvs[0];Me.getNormalMatrix(me);for(var T=h.material,J=T instanceof THREE.MultiMaterial,Y=1==J?h.material:null,w=0,K=y.length;w<K;w++){var H=y[w];if(Te.copy(H),!0===T.morphTargets)for(var Q=m.morphTargets,Z=h.morphTargetInfluences,g=0,$=Q.length;g<$;g++){var S,M=Z[g];0!==M&&(S=Q[g].vertices[w],Te.x+=(S.x-H.x)*M,Te.y+=(S.y-H.y)*M,Te.z+=(S.z-H.z)*M)}Ve.pushVertex(Te.x,Te.y,Te.z)}for(var b=0,_=q.length;b<_;b++){var C=q[b];if(void 0!==(T=1==J?Y.materials[C.materialIndex]:h.material)){var z=T.side,V=ue[C.a],j=ue[C.b],L=ue[C.c];if(!1!==Ve.checkTriangleVisibility(V,j,L)){var O=Ve.checkBackfaceCulling(V,j,L);if(z!==THREE.DoubleSide){if(z===THREE.FrontSide&&!1===O)continue;if(z===THREE.BackSide&&!0===O)continue}(le=Le()).id=h.id,le.v1.copy(V),le.v2.copy(j),le.v3.copy(L),le.normalModel.copy(C.normal),!1!==O||z!==THREE.BackSide&&z!==THREE.DoubleSide||le.normalModel.negate(),le.normalModel.applyMatrix3(Me).normalize();for(var ee=C.vertexNormals,B=0,te=Math.min(ee.length,3);B<te;B++){var ie=le.vertexNormalsModel[B];ie.copy(ee[B]),!1!==O||z!==THREE.BackSide&&z!==THREE.DoubleSide||ie.negate(),ie.applyMatrix3(Me).normalize()}le.vertexNormalsLength=ee.length;var re=X[b];if(void 0!==re)for(var W=0;W<3;W++)le.uvs[W].copy(re[W]);le.color=C.color,le.material=T,le.z=(V.positionScreen.z+j.positionScreen.z+L.positionScreen.z)/3,le.renderOrder=h.renderOrder,ye.elements.push(le)}}}}}else if(h instanceof THREE.Line){if(m instanceof THREE.BufferGeometry){if(void 0!==(f=m.attributes).position){for(v=0,u=(d=f.position.array).length;v<u;v+=3)Ve.pushVertex(d[v],d[v+1],d[v+2]);if(null!==m.index)for(v=0,u=(R=m.index.array).length;v<u;v+=2)Ve.pushLine(R[v],R[v+1]);else{var oe=h instanceof THREE.LineSegments?2:1;for(v=0,u=d.length/3-1;v<u;v+=oe)Ve.pushLine(v,v+1)}}}else if(m instanceof THREE.Geometry&&(Se.multiplyMatrices(ge,me),0!==(y=h.geometry.vertices).length))for((V=je()).positionScreen.copy(y[0]).applyMatrix4(Se),oe=h instanceof THREE.LineSegments?2:1,w=1,K=y.length;w<K;w++)(V=je()).positionScreen.copy(y[w]).applyMatrix4(Se),0<(w+1)%oe||(j=ue[se-2],Ce.copy(V.positionScreen),ze.copy(j.positionScreen),!0==(o=ze,p=c=l=s=a=n=void 0,n=0,a=1,s=(r=Ce).z+r.w,l=o.z+o.w,c=-r.z+r.w,p=-o.z+o.w,0<=s&&0<=l&&0<=c&&0<=p||!(s<0&&l<0||c<0&&p<0)&&(s<0?n=Math.max(n,s/(s-l)):l<0&&(a=Math.min(a,s/(s-l))),c<0?n=Math.max(n,c/(c-p)):p<0&&(a=Math.min(a,c/(c-p))),!(a<n||(r.lerp(o,n),o.lerp(r,1-a),0))))&&(Ce.multiplyScalar(1/Ce.w),ze.multiplyScalar(1/ze.w),(pe=Oe()).id=h.id,pe.v1.positionScreen.copy(Ce),pe.v2.positionScreen.copy(ze),pe.z=Math.max(Ce.z,ze.z),pe.renderOrder=h.renderOrder,pe.material=h.material,h.material.vertexColors===THREE.VertexColors&&(pe.vertexColors[0].copy(h.geometry.colors[w]),pe.vertexColors[1].copy(h.geometry.colors[w-1])),ye.elements.push(pe)))}else h instanceof THREE.Sprite&&(we.set(me.elements[12],me.elements[13],me.elements[14],1),we.applyMatrix4(ge),E=1/we.w,we.z*=E,-1<=we.z&&we.z<=1&&(i=void 0,(Ee=he!==Re?xe[he++]:(i=new THREE.RenderableSprite,xe.push(i),Re++,he++,i)).id=h.id,Ee.x=we.x*E,Ee.y=we.y*E,Ee.z=we.z,Ee.renderOrder=h.renderOrder,Ee.object=h,Ee.rotation=h.rotation,Ee.scale.x=h.scale.x*Math.abs(Ee.x-(we.x+t.projectionMatrix.elements[0])/(we.w+t.projectionMatrix.elements[12])),Ee.scale.y=h.scale.y*Math.abs(Ee.y-(we.y+t.projectionMatrix.elements[5])/(we.w+t.projectionMatrix.elements[13])),Ee.material=h.material,ye.elements.push(Ee)))}return!0===k&&ye.elements.sort(Be),ye}},function(){var t,i,r,e,o=0,n=0,a=window.innerWidth/2,s=window.innerHeight/2;function l(){a=window.innerWidth/2,s=window.innerHeight/2,t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),r.setSize(window.innerWidth,window.innerHeight)}function c(e){o=e.clientX-a,n=e.clientY-s}function p(e){1<e.touches.length&&(o=e.touches[0].pageX-a)}function d(e){1==e.touches.length&&(o=e.touches[0].pageX-a)}(v=document.createElement("div")).style.position="fixed",v.style.top="0px",v.style.left="0px",v.style.zIndex="-1",v.style.opacity="0.5",document.body.appendChild(v),(t=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1e4)).position.z=100,i=new THREE.Scene,(r=new THREE.CanvasRenderer({alpha:!0})).setPixelRatio(window.devicePixelRatio),r.setSize(window.innerWidth,window.innerHeight),v.appendChild(r.domElement);for(var E=2*Math.PI,h=new THREE.SpriteCanvasMaterial({color:10263708,program:function(e){e.beginPath(),e.arc(0,0,.5,0,E,!0),e.fill()}}),m=new THREE.Geometry,f=0;f<100;f++)(e=new THREE.Sprite(h)).position.x=2*Math.random()-1,e.position.y=2*Math.random()-1,e.position.z=2*Math.random()-1,e.position.normalize(),e.position.multiplyScalar(10*Math.random()+450),e.scale.x=e.scale.y=10,i.add(e),m.vertices.push(e.position);var v=new THREE.Line(m,new THREE.LineBasicMaterial({color:10263708,opacity:.5}));i.add(v),document.addEventListener("mousemove",c,!1),document.addEventListener("touchstart",p,!1),document.addEventListener("touchmove",d,!1),window.addEventListener("resize",l,!1),function e(){requestAnimationFrame(e),t.position.x+=.05*(o-t.position.x),t.position.y+=.05*(200-n-t.position.y),t.lookAt(i.position),r.render(i,t)}()}();